<?php

// ========================================================================
//        Copyright (c) 2012 Dominique Lacerte, All Rights Reserved.
// 
// Redistribution and use in source and binary forms are prohibited without 
//   prior written consent from Dominique Lacerte (internet@lacerte.org).
// ========================================================================

$LocaleLanguageCodes = array(
   'af' => 'Afrikaans',
   'sq' => 'Albanian',
   'am' => 'Amharic',
   'ar-DZ' => 'Arabic - Algeria',
   'ar-BH' => 'Arabic - Bahrain',
   'ar-EG' => 'Arabic - Egypt',
   'ar-IQ' => 'Arabic - Iraq',
   'ar-JO' => 'Arabic - Jordan',
   'ar-KW' => 'Arabic - Kuwait',
   'ar-LB' => 'Arabic - Lebanon',
   'ar-LY' => 'Arabic - Libya',
   'ar-MA' => 'Arabic - Morocco',
   'ar-OM' => 'Arabic - Oman',
   'ar-QA' => 'Arabic - Qatar',
   'ar-SA' => 'Arabic - Saudi Arabia',
   'ar-SY' => 'Arabic - Syria',
   'ar-TN' => 'Arabic - Tunisia',
   'ar-AE' => 'Arabic - United Arab Emirates',
   'ar-YE' => 'Arabic - Yemen',
   'hy' => 'Armenian',
   'as' => 'Assamese',
   'az-AZ' => 'Azeri - Cyrillic',
   'az-AZ' => 'Azeri - Latin',
   'eu' => 'Basque',
   'be' => 'Belarusian',
   'bn' => 'Bengali - Bangladesh',
   'bn' => 'Bengali - India',
   'bs' => 'Bosnian',
   'bg' => 'Bulgarian',
   'my' => 'Burmese',
   'ca' => 'Catalan',
   'zh-CN' => 'Chinese - China',
   'zh-HK' => 'Chinese - Hong Kong SAR',
   'zh-MO' => 'Chinese - Macau SAR',
   'zh-SG' => 'Chinese - Singapore',
   'zh-TW' => 'Chinese - Taiwan',
   'hr' => 'Croatian',
   'cs' => 'Czech',
   'da' => 'Danish',
   'dv' => 'Divehi; Dhivehi; Maldivian',
   'nl-BE' => 'Dutch - Belgium',
   'nl-NL' => 'Dutch - Netherlands',
//   '' => 'Edo',
   'en-AU' => 'English - Australia',
   'en-BZ' => 'English - Belize',
   'en-CA' => 'English - Canada',
   'en-CB' => 'English - Caribbean',
   'en-GB' => 'English - Great Britain',
   'en-IN' => 'English - India',
   'en-IE' => 'English - Ireland',
   'en-JM' => 'English - Jamaica',
   'en-NZ' => 'English - New Zealand',
   'en-PH' => 'English - Phillippines',
   'en-ZA' => 'English - Southern Africa',
   'en-TT' => 'English - Trinidad',
   'en-US' => 'English - United States',
//   '' => 'English - Zimbabwe',
   'et' => 'Estonian',
   'fo' => 'Faroese',
   'fa' => 'Farsi - Persian',
//   '' => 'Filipino',
   'fi' => 'Finnish',
   'fr-BE' => 'French - Belgium',
//   '' => 'French - Cameroon',
   'fr-CA' => 'French - Canada',
//   '' => 'French - Congo',
//   '' => 'French - Cote d'Ivoire',
   'fr-FR' => 'French - France',
   'fr-LU' => 'French - Luxembourg',
//   '' => 'French - Mali',
//   '' => 'French - Monaco',
//   '' => 'French - Morocco',
//   '' => 'French - Senegal',
   'fr-CH' => 'French - Switzerland',
//   '' => 'French - West Indies',
//   '' => 'Frisian - Netherlands',
   'mk' => 'FYRO Macedonia',
   'gd-IE' => 'Gaelic - Ireland',
   'gd' => 'Gaelic - Scotland',
//   '' => 'Galician',
//   '' => 'Georgian',
   'de-AT' => 'German - Austria',
   'de-DE' => 'German - Germany',
   'de-LI' => 'German - Liechtenstein',
   'de-LU' => 'German - Luxembourg',
   'de-CH' => 'German - Switzerland',
   'el' => 'Greek',
   'gn' => 'Guarani - Paraguay',
   'gu' => 'Gujarati',
   'he' => 'Hebrew',
   'hi' => 'Hindi',
   'hu' => 'Hungarian',
   'is' => 'Icelandic',
//   '' => 'Igbo - Nigeria',
   'id' => 'Indonesian',
   'it-IT' => 'Italian - Italy',
   'it-CH' => 'Italian - Switzerland',
   'ja' => 'Japanese',
   'kn' => 'Kannada',
   'ks' => 'Kashmiri',
   'kk' => 'Kazakh',
   'km' => 'Khmer',
//   '' => 'Konkani',
   'ko' => 'Korean',
//   '' => 'Kyrgyz - Cyrillic',
   'lo' => 'Lao',
   'la' => 'Latin',
   'lv' => 'Latvian',
   'lt' => 'Lithuanian',
   'ms-BN' => 'Malay - Brunei',
   'ms-MY' => 'Malay - Malaysia',
   'ml' => 'Malayalam',
   'mt' => 'Maltese',
//   '' => 'Manipuri',
   'mi' => 'Maori',
   'mr' => 'Marathi',
   'mn' => 'Mongolian',
   'mn' => 'Mongolian',
   'ne' => 'Nepali',
   'no-NO' => 'Norwegian - Bokml',
   'no-NO' => 'Norwegian - Nynorsk',
   'or' => 'Oriya',
   'pl' => 'Polish',
   'pt-BR' => 'Portuguese - Brazil',
   'pt-PT' => 'Portuguese - Portugal',
   'pa' => 'Punjabi',
   'rm' => 'Raeto-Romance',
   'ro-MO' => 'Romanian - Moldova',
   'ro' => 'Romanian - Romania',
   'ru' => 'Russian',
   'ru-MO' => 'Russian - Moldova',
//   '' => 'Sami Lappish',
   'sa' => 'Sanskrit',
   'sr-SP' => 'Serbian - Cyrillic',
   'sr-SP' => 'Serbian - Latin',
//   '' => 'Sesotho (Sutu)',
   'tn' => 'Setsuana',
   'sd' => 'Sindhi',
   'si' => 'Sinhala; Sinhalese',
   'sk' => 'Slovak',
   'sl' => 'Slovenian',
   'so' => 'Somali',
   'sb' => 'Sorbian',
   'es-AR' => 'Spanish - Argentina',
   'es-BO' => 'Spanish - Bolivia',
   'es-CL' => 'Spanish - Chile',
   'es-CO' => 'Spanish - Colombia',
   'es-CR' => 'Spanish - Costa Rica',
   'es-DO' => 'Spanish - Dominican Republic',
   'es-EC' => 'Spanish - Ecuador',
   'es-SV' => 'Spanish - El Salvador',
   'es-GT' => 'Spanish - Guatemala',
   'es-HN' => 'Spanish - Honduras',
   'es-MX' => 'Spanish - Mexico',
   'es-NI' => 'Spanish - Nicaragua',
   'es-PA' => 'Spanish - Panama',
   'es-PY' => 'Spanish - Paraguay',
   'es-PE' => 'Spanish - Peru',
   'es-PR' => 'Spanish - Puerto Rico',
   'es-ES' => 'Spanish - Spain (Traditional)',
   'es-UY' => 'Spanish - Uruguay',
   'es-VE' => 'Spanish - Venezuela',
   'sw' => 'Swahili',
   'sv-FI' => 'Swedish - Finland',
   'sv-SE' => 'Swedish - Sweden',
//   '' => 'Syriac',
   'tg' => 'Tajik',
   'ta' => 'Tamil',
   'tt' => 'Tatar',
   'te' => 'Telugu',
   'th' => 'Thai',
   'bo' => 'Tibetan',
   'ts' => 'Tsonga',
   'tr' => 'Turkish',
   'tk' => 'Turkmen',
   'uk' => 'Ukrainian',
   'ur' => 'Urdu',
   'uz-UZ' => 'Uzbek - Cyrillic',
   'uz-UZ' => 'Uzbek - Latin',
//   '' => 'Venda',
   'vi' => 'Vietnamese',
   'cy' => 'Welsh',
   'xh' => 'Xhosa',
   'yi' => 'Yiddish',
   'zu' => 'Zulu'
);

function LocaleGetClientPreferredLanguages()
{
   global $LocaleLanguageCodes;
   
   if (!isset($_SERVER["HTTP_ACCEPT_LANGUAGE"]))
   {
      return array();
   }
      
   $acceptedLanguages = $_SERVER["HTTP_ACCEPT_LANGUAGE"];

   // regex inspired from @GabrielAnderson on http://stackoverflow.com/questions/6038236/http-accept-language
   preg_match_all('/([a-z]{1,8}(-[a-z]{1,8})*)\s*(;\s*q\s*=\s*(1|0\.[0-9]+))?/i', $acceptedLanguages, $lang_parse);
   $langs = $lang_parse[1];
   $ranks = $lang_parse[4];

   // (create an associative array 'language' => 'preference')
   $lang2pref = array();
   for ($i = 0; $i < count($langs); $i++)
      $lang2pref[$langs[$i]] = (float) (!empty($ranks[$i]) ? $ranks[$i] : 1);

   // (comparison function for uksort)
   $cmpLangs = function ($a, $b) use ($lang2pref)
   {
      if ($lang2pref[$a] > $lang2pref[$b])
         return -1;
      elseif ($lang2pref[$a] < $lang2pref[$b])
         return 1;
      elseif (strlen($a) > strlen($b))
         return -1;
      elseif (strlen($a) < strlen($b))
         return 1;
      else
         return 0;
   };

   // sort the languages by prefered language and by the most specific region
   uksort($lang2pref, $cmpLangs);

   // look for the first/best match with our available languages
   $languages = array();
   foreach ($lang2pref as $key => $value)
   {
      if (isset($LocaleLanguageCodes[$key]))
      {
         $languages[] = $key;
      }
   }
   
   return $languages;
}


?>
